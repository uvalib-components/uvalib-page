<link rel="import" href="../polymer/polymer.html">
<!--
<link rel="import" href="../uvalib-chat/uvalib-chat.html" async>
-->
<link rel="import" href="../uvalib-footer/uvalib-footer.html" async>
<link rel="import" href="../uvalib-analytics/uvalib-analytics.html" async>
<link rel="import" href="../uvalib-header/uvalib-header.html">
<link rel="import" href="../uvalib-logos/uvalib-logo.html">
<link rel="import" href="../uvalib-nav/uvalib-nav.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../iron-media-query/iron-media-query.html">
<link rel="import" href="../uvalib-theme/uvalib-theme.html">
<link rel="import" href="../app-layout/app-drawer/app-drawer.html">
<link rel="import" href="../app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="../uva-brand-style/uva-layout-behavior.html">
<link rel="import" href="uvalib-page-behaviors.html">

<!--
`uvalib-page`
Library Web Page template

@demo demo/index.html
-->

<dom-module id="uvalib-page">
  <template>
    <style is="custom-style" include="uvalib-theme">
      :host {
        display: block;
        position: relative;
        @apply(--layout-vertical);
      }

      uvalib-header {
        z-index: 100000000000;
      }
      app-toolbar {
        width: 256px;
        height: 110px;
        padding: 20px 0px 0px 0px;

        background-color: var(--color-primary-blue);
      }
      uvalib-logo {
        width: 235px;
        height: 110px;
        margin: 10px;
      }
      app-drawer {
        z-index: 100000000000;
      }
      .content {

      }
      uvalib-footer {
        position: relative;
      }


    </style>

    <iron-media-query query="[[smallScreenQuery]]" query-matches="{{_smallScreen}}"></iron-media-query>
    <iron-media-query query="[[mediumScreenQuery]]" query-matches="{{_mediumScreen}}"></iron-media-query>
    <iron-media-query query="[[largeScreenQuery]]" query-matches="{{_largeScreen}}"></iron-media-query>


    <template is="dom-if" if="[[!_hasCustomHeader()]]" restamp>
      <uvalib-header tab-index="1" search-frame small-screen$="[[smallScreen]]" medium-screen$="[[mediumScreen]]" large-screen$="[[largeScreen]]" navigation="[[navigation]]"
                    on-open-drawer="_toggleDrawer"></uvalib-header>
    </template>
    <template is="dom-if" if="[[_hasCustomHeader()]]" restamp>
      <content tab-index="1" select="[header]"></content>
    </template>
<!--
    <uvalib-chat></uvalib-chat>
-->
    <!-- Lazy-create the drawer for small screen sizes. -->
    <!-- Two-way bind `drawerOpened` since app-drawer can update `opened` itself. -->
    <app-drawer id="sidenav" swipe-open tabindex="0">
      <app-toolbar>
        <uvalib-logo stacked reverse two-color></uvalib-logo>
      </app-toolbar>
      <uvalib-nav stacked navigation="[[mobileNavigation]]"></uvalib-nav>
    </app-drawer>


      <div tab-index="2" class="content"><content></content></div>


    <template is="dom-if" if="[[!_hasCustomFooter()]]" restamp>
      <uvalib-footer tab-index="3"
                     small-screen="[[_smallScreen]]"
                     medium-screen="[[_mediumScreen]]"
                     large-screen="[[_largeScreen]]"></uvalib-footer>
    </template>
    <template is="dom-if" if="[[_hasCustomFooter()]]" restamp>
      <content tab-index="3" select="[footer]"></content>
    </template>

    <!-- Library Site Analytics -->
    <uvalib-analytics site-id="[[analyticsSiteId]]"></uvalib-analytics>
  </template>

  <script>
    Polymer({

      is: 'uvalib-page',
      behaviors: [uvabehaviors.layout, uvalibbehaviors.page],

      properties: {

        /**
         * Array of JSON items that represent the navigation. Each JSON item has a label property, an icon property, and a url property.
         */
        navigation: {
          type: Array,
          value: [
            {"label": "About", "icon": "university", "url": "about-uva-library"},
            {"label": "Research", "icon": "graduation-cap", "url": "//www.library.virginia.edu/research/"},
            {"label": "Collections", "icon": "book", "url": "//www.library.virginia.edu/collections/"},
            {"label": "Services", "icon": "cloud", "url": "//www.library.virginia.edu/services/"}
          ],
        },
        mobileNavigation: {
          type: Array,
          value: [
            {"label": "About", "icon": "university", "url": "about-uva-library"},
            {"label": "Research", "icon": "graduation-cap", "url": "//www.library.virginia.edu/research/"},
            {"label": "Collections", "icon": "book", "url": "//www.library.virginia.edu/collections/"},
            {"label": "Services", "icon": "cloud", "url": "/www.library.virginia.edu/services/"}
          ],
        },
        /*
         *  Is the screen small sized (phone sized device)
         */
        smallScreen: {
          type: Boolean,
          notify: true,
          value: false,
          readOnly: true,
          reflectToAttribute: true
        },
        /*
         *  Is the screen medium sized (tablet sized device)
         */
        mediumScreen: {
          type: Boolean,
          notify: true,
          value: false,
          readOnly: true,
          reflectToAttribute: true
        },
        /*
         *  Is the screen large sized (desktop sized screen)
         */
        largeScreen: {
          type: Boolean,
          notify: true,
          value: false,
          readOnly: true,
          reflectToAttribute: true
        },
        _smallScreen: {
          type: Boolean,
          notify: true,
        },
        _mediumScreen: {
          type: Boolean,
          notify: true,
        },
        _largeScreen: {
          type: Boolean,
          notify: true,
        },
        /*
         *  The size of the screen ('small', 'medium', 'large')
         */
        screenSize: {
          type: String,
          value: 'large',
          notify: true,
          readOnly: true,
          reflectToAttribute: true
        }
      },
      observers: [
        '_updateScreenSize(_smallScreen,_mediumScreen,_largeScreen)'
      ],
      /**
       * Close the side navigation drawer if open
       */
      closeDrawer: function() {
        this.$.sidenav.close();
      },
      /**
       * Open the side navigation drawer if open
       */
      openDrawer: function(){
        this.$.sidenav.open();
      },
      _toggleDrawer: function() {
        this.$.sidenav.toggle();
      },
      _updateScreenSize: function() {
        this.debounce('screen', function(){
          if (this._smallScreen) {
            this._setScreenSize('small');
            this._setSmallScreen(true);
            this._setMediumScreen(false);
            this._setLargeScreen(false);
          } else if (this._mediumScreen) {
            this._setScreenSize('medium');
            this._setSmallScreen(false);
            this._setMediumScreen(true);
            this._setLargeScreen(false);
          } else {
            this._setScreenSize('large');
            this._setSmallScreen(false);
            this._setMediumScreen(false);
            this._setLargeScreen(true);
          }
        }, 100);
      },
    });

    // http://stackoverflow.com/questions/5007530/how-do-i-scroll-to-an-element-using-javascript
    // Finds y value of given object
    function findPos(obj) {
      var curtop = 0;
      if (obj.offsetParent) {
        do {
          curtop += obj.offsetTop;
        } while (obj = obj.offsetParent);
        return [curtop];
      }
    }
  </script>
</dom-module>
