<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../uvalib-footer/uvalib-footer.html" >
<link rel="import" href="../uvalib-analytics/uvalib-analytics.html">
<link rel="import" href="../uvalib-header/uvalib-header.html">
<link rel="import" href="../uvalib-logos/uvalib-logo.html">
<link rel="import" href="../uvalib-nav/uvalib-nav.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../iron-media-query/iron-media-query.html">
<link rel="import" href="../uvalib-theme/uvalib-theme.html">
<link rel="import" href="../app-layout/app-drawer/app-drawer.html">
<link rel="import" href="../app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="../uva-brand-style/uva-layout-behavior.html">
<link rel="import" href="uvalib-page-behaviors.html">

<!--
`uvalib-page`
Library Web Page template

@demo demo/index.html
-->

<dom-module id="uvalib-page">
  <template>
    <style is="custom-style" include="uvalib-theme">
      :host {
        display: block;
        position: relative;
      }

      uvalib-header {
        z-index: 100000000000;
      }
      app-toolbar {
        width: 256px;
        height: 110px;
        padding: 20px 0px 0px 0px;

        background-color: var(--color-primary-blue);
      }
      uvalib-logo {
        width: 235px;
        height: 110px;
        margin: 10px;
      }
      app-drawer {
        z-index: 1500
      }
      .content {

      }
      uvalib-footer {
        position: relative;
      }
    </style>

    <iron-media-query query="{{smallScreenQuery}}" query-matches="{{smallScreen}}"></iron-media-query>
    <iron-media-query query="{{mediumScreenQuery}}" query-matches="{{mediumScreen}}"></iron-media-query>
    <iron-media-query query="{{largeScreenQuery}}" query-matches="{{largeScreen}}"></iron-media-query>


    <template is="dom-if" if="{{!_hasCustomHeader()}}">
      <uvalib-header b$="{{b}}" search-frame small-screen="{{smallScreen}}" medium-screen="{{mediumScreen}}" large-screen="{{largeScreen}}" navigation="{{navigation}}"
                    on-open-drawer="_toggleDrawer" content-has-search-box="{{contentHasSearchBox}}"></uvalib-header>
    </template>
    <content select="[header]"></content>

    <!-- Lazy-create the drawer for small screen sizes. -->
    <!-- Two-way bind `drawerOpened` since app-drawer can update `opened` itself. -->
    <app-drawer id="sidenav" swipe-open tabindex="0">
      <app-toolbar>
        <uvalib-logo stacked reverse two-color></uvalib-logo>
      </app-toolbar>
      <uvalib-nav stacked navigation="{{mobileNavigation}}"></uvalib-nav>
    </app-drawer>

    <div class="content"><content></content></div>

    <template is="dom-if" if="{{!_hasCustomFooter()}}">
      <uvalib-footer></uvalib-footer>
    </template>
    <content select="[footer]"></content>



    <!-- Library Site Analytics -->
    <uvalib-analytics site-id="[[analyticsSiteId]]"></uvalib-analytics>
  </template>

  <script>
    Polymer({

      is: 'uvalib-page',
      behaviors: [uvabehaviors.layout, uvalibbehaviors.page],

      properties: {

        /**
         * Array of JSON items that represent the navigation. Each JSON item has a label property, an icon property, and a url property.
         */
        navigation: {
          type: Array,
          value: [
            {"label": "About", "icon": "university", "url": "/about-uva-library/"},
            {"label": "Research", "icon": "graduation-cap", "url": "/research/"},
            {"label": "Collections", "icon": "book", "url": "/collections/"},
            {"label": "Services", "icon": "cloud", "url": "/services/"}
          ],
        },
        mobileNavigation: {
          type: Array,
          value: [
            {"label": "About", "icon": "university", "url": "/about-uva-library/"},
            {"label": "Research", "icon": "graduation-cap", "url": "/research/"},
            {"label": "Collections", "icon": "book", "url": "/collections/"},
            {"label": "Services", "icon": "cloud", "url": "/services/"},
            {"label": "Ask A Librarian", "icon": "comments", "url": "/askalibrarian/"}
          ],
        },
        contentHasSearchBox: {
          type: Boolean,
          value: false
        },
        mainContent: {
          type: String,
          value: "content"
        },
        searchInput: {
          type: String,
          value: "searchbox"
        },
        smallScreen: {
          type: Boolean,
          notify: true,
          value: false,
          reflectToAttribute: true
        },
        mediumScreen: {
          type: Boolean,
          notify: true,
          value: false,
          reflectToAttribute: true
        },
        largeScreen: {
          type: Boolean,
          notify: true,
          value: false,
          reflectToAttribute: true
        },
        screenSize: {
          type: String,
          value: 'large',
          notify: true,
          readOnly: true,
          reflectToAttribute: true
        },
        b: Boolean
      },
      listeners: {
        'skiptocontent': '_focusOnContent',
        'skiptosearch': '_focusOnSearch'
      },
      observers: [
        '_updateScreenSize(smallScreen,mediumScreen)'
      ],
      _toggleDrawer: function() {
        this.$.sidenav.toggle();
      },
      _updateScreenSize: function() {
        this._setScreenSize(
          (this.smallScreen)?'small':
                              (this.mediumScreen)?'medium':
                                                   'large'
        );
      },
      _focusOnContent: function() {
        this.querySelector(this.mainContent).tabIndex = "-1";
        // reduce y position of scroll to account for sticky header so content does not roll up behind it
        window.scrollTo(0,findPos(document.getElementById(this.mainContent.split('#')[1])) - 110);
        this.querySelector(this.mainContent).focus();
      },
      _focusOnSearch: function() {
        this.querySelector(this.searchInput).tabIndex = "-1";
        // reduce y position of scroll to account for sticky header so content does not roll up behind it
        window.scrollTo(0,findPos(document.getElementById(this.searchInput.split('#')[1])) - 110);
        this.querySelector(this.searchInput).focus();
      }
    });

    // http://stackoverflow.com/questions/5007530/how-do-i-scroll-to-an-element-using-javascript
    // Finds y value of given object
    function findPos(obj) {
      var curtop = 0;
      if (obj.offsetParent) {
        do {
          curtop += obj.offsetTop;
        } while (obj = obj.offsetParent);
        return [curtop];
      }
    }
  </script>
</dom-module>
